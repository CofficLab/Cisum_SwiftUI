---
globs: "**/*View.swift,**/*Screen.swift"
description: SwiftUI è§†å›¾æ–‡ä»¶æ¶æ„è§„èŒƒï¼Œå®šä¹‰è§†å›¾çš„ä»£ç ç»„ç»‡ã€äº‹ä»¶å¤„ç†ã€æ—¥å¿—è¾“å‡ºç­‰æœ€ä½³å®è·µ
---

# SwiftUI è§†å›¾æ–‡ä»¶æ¶æ„è§„èŒƒ

æœ¬è§„åˆ™å®šä¹‰äº† SwiftUI è§†å›¾æ–‡ä»¶çš„æ ‡å‡†æ¶æ„å’Œç¼–ç è§„èŒƒï¼Œç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯è°ƒè¯•æ€§ã€‚

## è§„åˆ™é€‚ç”¨èŒƒå›´

- æ‰€æœ‰ä»¥ `View.swift` ç»“å°¾çš„æ–‡ä»¶
- æ‰€æœ‰ä»¥ `Screen.swift` ç»“å°¾çš„æ–‡ä»¶
- æ‰€æœ‰å®ç°äº† `View` åè®®çš„ SwiftUI è§†å›¾

## å¼ºåˆ¶è¦æ±‚

### 1. æ—¥å¿—æ§åˆ¶

æ‰€æœ‰è§†å›¾å¿…é¡»å®šä¹‰ç»Ÿä¸€çš„æ—¥å¿—æ§åˆ¶å˜é‡ï¼š

```swift
struct MyView: View, SuperLog, SuperThread {
    nonisolated static let emoji = "ğŸ¨"  // è§†å›¾ä¸“å± emoji
    nonisolated static let verbose = false  // æ—¥å¿—å¼€å…³
    
    // ... è§†å›¾å†…å®¹
}
```

**æ³¨æ„**ï¼š

- å¯¹äºæ³›å‹è§†å›¾ï¼ˆå¦‚ `MyView<Content>`ï¼‰ï¼Œä½¿ç”¨å®ä¾‹å˜é‡ï¼š`private let verbose = false`
- emoji åº”è¯¥ä¸è§†å›¾åŠŸèƒ½ç›¸å…³ï¼Œä¾¿äºåœ¨æ—¥å¿—ä¸­è¯†åˆ«
- æ‰€æœ‰æ—¥å¿—è¾“å‡ºå¿…é¡»ä½¿ç”¨ `Self.verbose` æˆ– `verbose` æ§åˆ¶

### 2. Body æ¸²æŸ“æ—¥å¿—

body çš„ç¬¬ä¸€è¡Œåº”è¯¥è¾“å‡ºæ¸²æŸ“æ—¥å¿—ï¼š

```swift
var body: some View {
    if Self.verbose {
        os_log("\(self.t)ğŸ“º å¼€å§‹æ¸²æŸ“")
    }
    
    return VStack {
        // è§†å›¾å†…å®¹
    }
}
```

### 3. ä»£ç ç»„ç»‡ç»“æ„

è§†å›¾æ–‡ä»¶å¿…é¡»æŒ‰ç…§ä»¥ä¸‹é¡ºåºç»„ç»‡ï¼š

```swift
struct MyView: View {
    // 1. é™æ€å±æ€§
    nonisolated static let emoji = "ğŸ¨"
    nonisolated static let verbose = false
    
    // 2. @EnvironmentObject
    @EnvironmentObject var app: AppProvider
    
    // 3. @State å’Œå…¶ä»–å±æ€§
    @State private var isLoading = false
    
    // 4. è®¡ç®—å±æ€§
    var title: String { "æ ‡é¢˜" }
    
    // 5. body
    var body: some View { }
    
    // 6. å†…éƒ¨ç±»å‹ï¼ˆå¦‚ enumï¼‰
    enum MyEnum { }
}

// MARK: - Action
extension MyView {
    // ä¸šåŠ¡æ“ä½œæ–¹æ³•
}

// MARK: - Event Handler
extension MyView {
    // äº‹ä»¶å¤„ç†æ–¹æ³•
}

// MARK: - Preview
#if os(macOS)
#Preview("App - Large") { }
#Preview("App - Small") { }
#endif

#if os(iOS)
#Preview("iPhone") { }
#endif
```

### 4. äº‹ä»¶å¤„ç†è§„èŒƒ

#### body ä¸­ä½¿ç”¨æ–¹æ³•å¼•ç”¨

**å¼ºåˆ¶è¦æ±‚**ï¼šbody ä¸­çš„æ‰€æœ‰äº‹ä»¶å¤„ç†å¿…é¡»ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼Œä¸å¾—å†…è”ä»£ç 

```swift
// âŒ é”™è¯¯ï¼šå†…è”ä»£ç 
.onAppear {
    self.isLoading = true
    Task {
        await loadData()
    }
}

// âœ… æ­£ç¡®ï¼šæ–¹æ³•å¼•ç”¨
.onAppear(perform: handleOnAppear)
```

#### äº‹ä»¶å¤„ç†æ–¹æ³•å‘½å

æ‰€æœ‰äº‹ä»¶å¤„ç†æ–¹æ³•å¿…é¡»ä»¥ `handle` å¼€å¤´ï¼š

```swift
// MARK: - Event Handler

extension MyView {
    /// å¤„ç†è§†å›¾å‡ºç°äº‹ä»¶
    func handleOnAppear() { }
    
    /// å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    func handleButtonTap() { }
    
    /// å¤„ç†æ•°æ®å˜åŒ–äº‹ä»¶
    func handleDataChanged(_ data: Data) { }
}
```

### 5. æ–¹æ³•æ–‡æ¡£æ³¨é‡Š

æ‰€æœ‰é trivial æ–¹æ³•å¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Šï¼š

```swift
/// å¤„ç†æ–‡ä»¶å¯¼å…¥
///
/// å½“ç”¨æˆ·é€šè¿‡æ–‡ä»¶é€‰æ‹©å™¨å¯¼å…¥æ–‡ä»¶æ—¶è§¦å‘ã€‚
/// è·å–å­˜å‚¨æ ¹ç›®å½•å¹¶å°†æ–‡ä»¶å¤åˆ¶åˆ°è¯¥ç›®å½•ã€‚
///
/// ## å¤„ç†æµç¨‹
/// 1. éªŒè¯æ–‡ä»¶æ ¼å¼
/// 2. è·å–å­˜å‚¨ç›®å½•
/// 3. å¤åˆ¶æ–‡ä»¶
///
/// - Parameter result: æ–‡ä»¶å¯¼å…¥çš„ç»“æœ
/// - Throws: å¦‚æœå¤åˆ¶å¤±è´¥åˆ™æŠ›å‡ºé”™è¯¯
func handleFileImport(result: Result<[URL], Error>) {
    // å®ç°
}
```

### 6. æ—¥å¿—è¾“å‡ºè§„èŒƒ

#### æ—¥å¿— Emoji ä½¿ç”¨

```swift
ğŸ“º - è§†å›¾æ¸²æŸ“
ğŸ‘€ - è§†å›¾å‡ºç°
ğŸ‘‹ - è§†å›¾æ¶ˆå¤±
ğŸ“¥ - æ•°æ®å¯¼å…¥
ğŸ“¤ - æ•°æ®å¯¼å‡º
âœ… - æ“ä½œæˆåŠŸ
âŒ - æ“ä½œå¤±è´¥
âš ï¸ - è­¦å‘Š
ğŸ”„ - çŠ¶æ€å˜åŒ–/åˆ·æ–°
ğŸ“‚ - æ–‡ä»¶/ç›®å½•æ“ä½œ
ğŸ“„ - å•ä¸ªæ–‡ä»¶æ“ä½œ
ğŸµ - éŸ³é¢‘ç›¸å…³
ğŸ“– - ä¹¦ç±ç›¸å…³
ğŸ‘† - ç”¨æˆ·ç‚¹å‡»
ğŸ” - æœç´¢/æŸ¥æ‰¾
```

#### è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

```swift
func handleFileImport(result: Result<[URL], Error>) {
    if Self.verbose {
        os_log("\(self.t)ğŸ“¥ å¤„ç†æ–‡ä»¶å¯¼å…¥")
    }
    
    switch result {
    case let .success(urls):
        if Self.verbose {
            os_log("\(self.t)âœ… æˆåŠŸå¯¼å…¥ \(urls.count) ä¸ªæ–‡ä»¶")
        }
        // å¤„ç†æˆåŠŸ
        
    case let .failure(error):
        os_log(.error, "\(self.t)âŒ å¯¼å…¥å¤±è´¥: \(error.localizedDescription)")
    }
}
```

**æ³¨æ„**ï¼šé”™è¯¯æ—¥å¿—ï¼ˆ`.error`ï¼‰æ— éœ€ `verbose` æ§åˆ¶ï¼Œåº”è¯¥å§‹ç»ˆè¾“å‡ºã€‚

### 7. MARK åˆ†ç»„è§„èŒƒ

å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ MARK åˆ†ç»„ï¼ˆå‚è€ƒ [swift-mark-rule](mdc:.cursor/rules/swift-mark-rule.mdc)ï¼‰ï¼š

```swift
// MARK: - Action
// ä¸šåŠ¡æ“ä½œæ–¹æ³•ï¼šæ’­æ”¾ã€æš‚åœã€åˆ é™¤ã€å¤åˆ¶ç­‰

// MARK: - Setter
// çŠ¶æ€æ›´æ–°æ–¹æ³•ï¼ˆå¯é€‰ï¼‰

// MARK: - Event Handler
// äº‹ä»¶å¤„ç†æ–¹æ³•ï¼šhandle å¼€å¤´çš„æ‰€æœ‰æ–¹æ³•

// MARK: - Preview
// é¢„è§ˆä»£ç 
```

### 8. Preview è§„èŒƒ

æ‰€æœ‰è§†å›¾æ–‡ä»¶å¿…é¡»åŒ…å«é¢„è§ˆï¼ˆå‚è€ƒ [swift-preview-rule](mdc:.cursor/rules/swift-preview-rule.mdc)ï¼‰ï¼š

```swift
// MARK: - Preview

#if os(macOS)
#Preview("App - Large") {
    AppPreview()
        .frame(width: 600, height: 1000)
}

#Preview("App - Small") {
    AppPreview()
        .frame(width: 600, height: 600)
}
#endif

#if os(iOS)
#Preview("iPhone") {
    AppPreview()
}
#endif
```

## å®Œæ•´ç¤ºä¾‹

å‚è€ƒä»¥ä¸‹ä¼˜ç§€å®ç°ï¼š

- [ContentView.swift](mdc:Core/Views/Layout/ContentView.swift) - äº‹ä»¶é©±åŠ¨æ¶æ„ç¤ºä¾‹
- [BookGrid.swift](mdc:Plugins/Book/Views/BookGrid.swift) - å®Œæ•´çš„è§†å›¾æ¶æ„
- [BookDBView.swift](mdc:Plugins/Book/Views/BookDBView.swift) - äº‹ä»¶å¤„ç†æœ€ä½³å®è·µ
- [AudioDBView.swift](mdc:Plugins/Audio/Views/AudioDBView.swift) - Action åˆ†ç»„ç¤ºä¾‹

## ç¤ºä¾‹æ¨¡æ¿

```swift
import SwiftUI
import OSLog

struct MyView: View, SuperLog, SuperThread {
    nonisolated static let emoji = "ğŸ¨"
    nonisolated static let verbose = false
    
    @EnvironmentObject var app: AppProvider
    
    /// çŠ¶æ€æè¿°
    @State private var isLoading = false
    
    var body: some View {
        if Self.verbose {
            os_log("\(self.t)ğŸ“º å¼€å§‹æ¸²æŸ“")
        }
        
        return VStack {
            Text("å†…å®¹")
        }
        .onAppear(perform: handleOnAppear)
    }
}

// MARK: - Action

extension MyView {
    /// åŠ è½½æ•°æ®
    ///
    /// ä»æœåŠ¡å™¨åŠ è½½å¿…è¦çš„æ•°æ®ã€‚
    private func loadData() async {
        if Self.verbose {
            os_log("\(self.t)ğŸ”„ å¼€å§‹åŠ è½½æ•°æ®")
        }
        
        // åŠ è½½é€»è¾‘
        
        if Self.verbose {
            os_log("\(self.t)âœ… æ•°æ®åŠ è½½å®Œæˆ")
        }
    }
}

// MARK: - Event Handler

extension MyView {
    /// å¤„ç†è§†å›¾å‡ºç°äº‹ä»¶
    ///
    /// å½“è§†å›¾é¦–æ¬¡å‡ºç°æ—¶è§¦å‘ï¼Œæ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚
    func handleOnAppear() {
        if Self.verbose {
            os_log("\(self.t)ğŸ‘€ è§†å›¾å·²å‡ºç°")
        }
        
        Task {
            await loadData()
        }
    }
}

// MARK: - Preview

#if os(macOS)
#Preview("App - Large") {
    AppPreview()
        .frame(width: 600, height: 1000)
}

#Preview("App - Small") {
    AppPreview()
        .frame(width: 600, height: 600)
}
#endif

#if os(iOS)
#Preview("iPhone") {
    AppPreview()
}
#endif
```

## æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š

- [ ] å®šä¹‰äº† `emoji` å’Œ `verbose` é™æ€å¸¸é‡
- [ ] body ç¬¬ä¸€è¡Œæœ‰æ¸²æŸ“æ—¥å¿—
- [ ] æ‰€æœ‰äº‹ä»¶å¤„ç†ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼Œæ— å†…è”ä»£ç 
- [ ] äº‹ä»¶å¤„ç†æ–¹æ³•ä»¥ `handle` å¼€å¤´
- [ ] æ‰€æœ‰æ–¹æ³•éƒ½æœ‰æ–‡æ¡£æ³¨é‡Š
- [ ] ä½¿ç”¨æ­£ç¡®çš„ MARK åˆ†ç»„
- [ ] æ—¥å¿—è¾“å‡ºä½¿ç”¨åˆé€‚çš„ emoji
- [ ] åŒ…å«å¤šå°ºå¯¸é¢„è§ˆ
- [ ] é”™è¯¯æ—¥å¿—å§‹ç»ˆè¾“å‡ºï¼ŒæˆåŠŸæ—¥å¿—å— `verbose` æ§åˆ¶

## ä¼˜åŠ¿

éµå¾ªæ­¤è§„èŒƒå¯ä»¥è·å¾—ï¼š

1. **ä¸€è‡´æ€§** - æ‰€æœ‰è§†å›¾æ–‡ä»¶é£æ ¼ç»Ÿä¸€
2. **å¯è¯»æ€§** - æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œå‘½å
3. **å¯ç»´æŠ¤æ€§** - æ˜“äºä¿®æ”¹å’Œæ‰©å±•
4. **å¯è°ƒè¯•æ€§** - è¯¦ç»†çš„æ—¥å¿—è¿½è¸ª
5. **å¯æµ‹è¯•æ€§** - æ–¹æ³•èŒè´£å•ä¸€
6. **å›¢é˜Ÿåä½œ** - é™ä½ç†è§£æˆæœ¬
